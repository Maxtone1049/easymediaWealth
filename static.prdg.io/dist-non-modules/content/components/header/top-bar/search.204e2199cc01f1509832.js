window.topbarSearch=function(){var e={sbGlobalNavSearchInputs:$(".sbGlobalNavSearchInput"),sbGlobalNavSearch:$("#sbGlobalNavSearch"),sbGlobalSearchTypeSelector:$("#sbGlobalNavSearchSelector"),sbGlobalSearchCurrentSelection:$("#sbGlobalNavSearchCurrentSelection"),sbGlobalSearchSubmitBtn:$("#sbGlobalNavSearchSubmit"),sbGlobalSearchSuggestCont:$("#sbGlobalNavSearchSuggestCont"),sbGlobalSearchInputShop:$("#sbGlobalNavSearchInputShop"),sbGlobalNavSearchInputRewards:$("#sbGlobalNavSearchInputRewards"),sbGlobalNavSearchInputURewards:$("#sbGlobalNavSearchInputUniversalRewards"),document:$(document)};e.sbGlobalSearchTypeSelectorItems=e.sbGlobalSearchTypeSelector.children("li"),e.sbGlobalSearchSuggestList=e.sbGlobalSearchSuggestCont.children("ul");var a="SOURCE_ID_PLACEHOLDER",s={webSearchSourceId:{direct:11,suggestion:12},finalUrl:{web:"/?f=SOURCE_ID_PLACEHOLDER&q=",shop:"/shop/search/?shq=",rewards:"/p/category/-3?srt=5&src=",universalRewards:"/universal-rewards?srt=5&src=",swagstakes:"/s/category/-3?srt=5&src="},classNames:{web:"websearch",shop:"shopsearch",rewards:"rewardssearch",universalRewards:"universalrewardssearch",swagstakes:"swagstakessearch"},autoSuggestTitleClassName:"categoryTitle",autoSuggestSelectedClassName:"selected",selectedSearchTypeClassName:"selectedSearchType",searchTypeOnPageRender:"web",selectedSearchType:"web"},t={getSearchTerm:function(){return e.sbGlobalNavSearchInputs.parent().find("input."+s.selectedSearchTypeClassName).val().trim()},getSearchUrl:function(e,l,r){var c=s.finalUrl[e];return"web"===e&&(c=c.replace(a,s.webSearchSourceId[r?"suggestion":"direct"])),t.getUrlPrefix()+c+encodeURIComponent(l).replace(/\%20/g,"+")},getUrlPrefix:function(){return void 0===sbGlbl.isExternalBar?"":sbtbDomain},submit:function(a){var l=e.sbGlobalSearchTypeSelector.find("."+s.selectedSearchTypeClassName).attr("data-search-type"),r=t.getSearchTerm();t.preSubmitChecks(r,l)&&(window.location.href=t.getSearchUrl(l,r,a))},preSubmitChecks:function(e,a){return e.length&&!e.match(/^\W+$/)&&(s.searchTypeOnPageRender!==a||void 0===sbGlbl.shopSearchTerm||sbGlbl.shopSearchTerm.toUpperCase()!==e.toUpperCase())},selectSearchType:function(a,t){var l,r;"string"==typeof a?(r=a,l=e.sbGlobalSearchTypeSelector.find("li[data-search-type="+a+"]")):(r=t.attr("data-search-type"),l=t),e.sbGlobalSearchTypeSelectorItems.removeClass(s.selectedSearchTypeClassName),l.addClass(s.selectedSearchTypeClassName),e.sbGlobalNavSearchInputs.removeClass(s.selectedSearchTypeClassName),e.sbGlobalNavSearchInputs.parent().find("input[data-search-type="+r+"]").addClass(s.selectedSearchTypeClassName),$.each(s.classNames,(function(a,s){e.sbGlobalSearchSubmitBtn.removeClass(s),e.sbGlobalSearchCurrentSelection.removeClass(s),e.sbGlobalNavSearch.removeClass(s)})),e.sbGlobalSearchCurrentSelection.text(l.text()).addClass(s.classNames[r]),e.sbGlobalNavSearch.addClass(s.classNames[r]).addClass("focus"),e.sbGlobalSearchSubmitBtn.addClass(s.classNames[r]),e.sbGlobalSearchCurrentSelection.is(":hidden")&&e.sbGlobalSearchCurrentSelection.fadeIn()},searchFocus:function(){e.sbGlobalNavSearch.addClass("focus"),e.sbGlobalNavSearchInputs.parent().find("input."+s.selectedSearchTypeClassName).focus()},hideSelector:function(){var a=e.sbGlobalSearchTypeSelector;a.is(":visible")&&a.hide()},toggleSelector:function(){var a=e.sbGlobalSearchTypeSelector;a.is(":visible")?a.hide():(a.show(),t.closeAutoSuggest())},initAutoSuggest:function(){e.sbGlobalSearchInputShop.keyup((function(a){if(27==a.keyCode)t.closeAutoSuggest();else if(38==a.keyCode||40==a.keyCode){var l=e.sbGlobalSearchSuggestList;if(!l.children().length)return;var r=e.sbGlobalSearchSuggestList.find("li."+s.autoSuggestSelectedClassName);if(r.length){r.removeClass(s.autoSuggestSelectedClassName);c=(r.is(":nth-child(2)")&&38==a.keyCode?l.find("li").not("."+s.autoSuggestTitleClassName).last():r.is(":last-child")&&40==a.keyCode?l.find("li").not("."+s.autoSuggestTitleClassName).first():38==a.keyCode?r.prevAll().not("."+s.autoSuggestTitleClassName).first():r.nextAll().not("."+s.autoSuggestTitleClassName).first()).addClass(s.autoSuggestSelectedClassName).find("span.suggestionName").text();e.sbGlobalSearchInputShop.val(c)}else{var c=l.find("li").not("."+s.autoSuggestTitleClassName).first().addClass(s.autoSuggestSelectedClassName).find("span.suggestionName").text();e.sbGlobalSearchInputShop.val(c)}}else if(13!=a.keyCode){t.hideSelector();var o=e.sbGlobalSearchInputShop.val().trim();o.length?t.getAutoSuggestResults(o):t.closeAutoSuggest()}}))},closeAutoSuggest:function(){e.sbGlobalSearchSuggestCont.hide(),e.sbGlobalSearchSuggestList.empty(),$("#suggest").hide()},getAutoSuggestResults:function(e){!0!==s.ajaxRunning&&(s.ajaxRunning=!0,$.ajax({type:"POST",url:"/?cmd=sh-search-autocomplete",dataType:"JSON",data:{term:e},success:function(e){t.renderAutoSuggestResults(e)},complete:function(){s.ajaxRunning=!1}}))},renderAutoSuggestResults:function(a){var s=e.sbGlobalSearchSuggestList;if(s.empty(),a.data.length){e.sbGlobalSearchSuggestCont.show();var l=0,r="";$.each(a.data,(function(e,c){if(c.name==r)return!0;if(r=c.name,++l>4)return!0;var o=4!=a.locationId?"$":"&pound;",n="";c.sbPerDollar>0&&(c.upTo&&(n+="Up to "),n+=c.sbPerDollar+" SB",c.isPerDollar&&(n+=" per "+o+"1")),s.append('<li class="sbShopSearchSuggestion"><a href="'+t.getUrlPrefix()+sbHelpers.updateQueryString("page",293,c.url)+'" class="sbShopSearchSuggestionCta"><span class="suggestionName">'+c.name+'</span><span class="suggestionSbAmount">'+n+"</span></a></li>")}))}},getCurrentSearchType:function(){var a=e.sbGlobalSearchTypeSelectorItems.filter("."+s.selectedSearchTypeClassName)[0];return a&&(s.selectedSearchType=a.getAttribute("data-search-type"),s.searchTypeOnPageRender=s.selectSearchType),s.selectedSearchType},init:function(a){sbGlbl.location.supports.shopEarn||"shop"==a?(e.sbGlobalSearchTypeSelectorItems.click((function(){var e=$(this);e.hasClass(s.selectedSearchTypeClassName)||(t.hideSelector(),t.selectSearchType(void 0,e))})),e.sbGlobalSearchCurrentSelection.bind("click",(function(){t.toggleSelector()}))):e.sbGlobalSearchCurrentSelection.addClass("hideAfter"),e.sbGlobalNavSearchInputs.keypress((function(e){if(sbHelpers.isViewport("tiny")&&sbPage.arrHtmlClassList.add("isMenuActive","isSearchMenuActive"),13==e.keyCode){var a=e.target.getAttribute("data-search-type");sbHelpers.isNonEmptyString(a)&&"web"!==a&&t.submit()}})),window.addEventListener("viewportChange",(function(a){"use strict";var s=a.detail;"object"==typeof s&&"tiny"!==s.strViewportPrevious&&"tiny"===s.strViewport&&e.sbGlobalNavSearchInputs.parent().has($(document.activeElement)).length&&document.activeElement.blur()})),$.each(e.sbGlobalSearchTypeSelectorItems,(function(e,a){var t=$(a);t.addClass(s.classNames[t.attr("data-search-type")])})),!sbHelpers.isViewport("wide")&&sbHelpers.isMobile2()||t.searchFocus(),e.sbGlobalNavSearchInputs.focusout((function(a){var s=$(a.target);s.is(e.sbGlobalNavSearch)||s.is(e.sbGlobalNavSearchInputs)||(e.sbGlobalNavSearch.removeClass("focus"),t.closeAutoSuggest())})),e.document.bind("click",(function(a){e.sbGlobalSearchTypeSelector.is(":visible")&&a.target!=e.sbGlobalSearchCurrentSelection.get(0)&&(t.hideSelector(),t.closeAutoSuggest()),a.offsetParent!=e.sbGlobalSearchSuggestCont.get(0)&&t.closeAutoSuggest()})),e.sbGlobalNavSearch.bind("click",(function(){e.sbGlobalNavSearchInputs.not(":focus")&&t.searchFocus()})),t.initAutoSuggest()}};return e.document.ready((function(){var a=t.getCurrentSearchType(),s=$("#sbGlobalNavSearchInputContainer"),l=s.closest(".sbTopBarSection").find("#suggest"),r=!1;t.init(a),s.delegate("tr","click",(function(){t.submit()}));var c=$("#sbGlobalNavSearchCurrentSelection").outerWidth();function o(){l.length||(l=s.closest(".sbTopBarSection").find("#suggest"));var e=s.parent().width()-c;l.width(e).find("td").width(e)}s.children(".sbGlobalNavSearchInput").keyup((function(){e.sbGlobalNavSearchInputs.val(this.value),r||(o(),l.length&&(r=!0))})),$(window).resize((function(){o()}))})),{submit:t.submit}}();