"object"!=typeof sbGlbl&&(sbGlbl={}),function($){var strRowsCountClass="sbTrayNumberOfRowsIs",strHorizontalClass=sbCards.shouldUseHorizontalScroll()?"":"noHorizontalScrollMobile",NOT_SET_VALUE=-1,answerCardV2Applicable=NOT_SET_VALUE,props={trayDefaultOptions:{defaultTrayClassesArr:["sbTray",strHorizontalClass,strRowsCountClass],theme:"sbHCTBookendBlk sbTrayV3",fadeControls:0,glueToMaxWidthElm:$("body"),allowGetMoreItems:!1,id:NOT_SET_VALUE,defaultItemWidth:210,sneakPeekNextPageCardsWidth:NOT_SET_VALUE,classes:[],isShopPromoTray:!1},Trays:{get:function(e){return props.Trays[e]},getAll:function(){var e={};for(var t in props.Trays){var r=props.Trays[t];"function"!=typeof r&&(e[t]=r)}return e},refreshAll:function(){$.each(props.Trays,(function(e,t){sbHelpers.isNumeric(e)&&this.refresh()}))}},curTrayInx:0,maximumItemsForNoHorizontalScrollSingleRow:2,minimumItemsForSeeMore:4,cardClass:"sbCard",defaultAppendToContClass:"trayWrapper",premiumCardClass:"showPremiumBanner",doubleWideCardClass:"doubleWideCard",traySelector:"sbTray",trayInnerSelector:"sbTrayInner",trayInnerWrapBackgroundClass:"sbTrayInnerWrapBackground",answerNoInitialProfilerCaseClass:"answerNoInitialProfilerCase",traySeeMoreSelector:"sbTraySeeMore",trayInnerContainerClass:"sbTrayInnerContainer"},methods={ensureDomNode:function(){var e=Array.prototype.slice.call(arguments,0),t=e.shift();return t instanceof jQuery||(t=$(t)),t.length?t:this.ensureDomNode.apply(this,e)},bindContext:function(e,t){return Function.prototype.bind?e.bind(t):function(){e.call(t)}}};function Tray(e){for(var t in props.trayDefaultOptions)props.trayDefaultOptions.hasOwnProperty(t)&&(this[t]=props.trayDefaultOptions[t]);for(var t in e)if(e.hasOwnProperty(t)){var r=this[t]=e[t];r.nodeType&&(r=$(r))}this.init()}function setSneakPeekNextPageCardsWidth(e){e.sneakPeekNextPageCardsWidth=e.getSneakPeekNextPageCardsWidth.call(e,!0)}function executeMethods(e,t){for(var r,s=0,a=t.length;s<a;s++)(r=e[t[s]])&&r.call(e)}function isAnswerTray(e){return e.getId()===sbCards.objTrays.answer}Tray.prototype.init=function(){if(!this.wasInitialized){this.wasInitialized=!0,this.setTrayOffset(0),this.page=0;executeMethods(this,["setDomId","setAppendToElement","createTrayAndAppendHTML","setOuterTrayWidth","setTrayPageWidth","decreaseRowCountIfEmptyColumn","setTitle","attachEvents"]),this.initNavigation(),this.onAfterTrayRendered&&this.onAfterTrayRendered(),props.Trays[this.getId()]=this,this.removeTrayIfEmpty(!0)}},Tray.prototype.refresh=function(){executeMethods(this,["setTrayViewProps","setTrayOffset","setTrayPageWidth","decreaseRowCountIfEmptyColumn","ensureEnoughItemsForSeeMore"])},Tray.prototype.setTrayOffset=function(e){this.scrollOffset=void 0!==e?e:this.trayInnerWrap.position().left},Tray.prototype.getTrayOffset=function(){return this.setTrayOffset(),this.scrollOffset},Tray.prototype.removeItem=function(e,t){this.items=this.items.filter((function(){return this!=e[0]})),setTimeout((function(){"function"==typeof t&&t()}),0),this.refresh()},Tray.prototype.setAllItems=function(e){var t=this.items.add(e);this.items=t},Tray.prototype.getAllItems=function(){return this.items},Tray.prototype.getItemsLen=function(){return this.items.length},Tray.prototype.setCurItems=function(e,t){var r=e instanceof jQuery?e:$(e);this.curItems=r.filter((function(){var e=$(this);return e.hasClass("hiddenCard")&&!e.hasClass("disabledCard")&&setTimeout(function(e){return function(){e.hasClass("hiddenCard")&&(addCardToFailedPseudoCardCache(e),disableCard(e))}}(e),3e3),!e.hasClass("disabledCard")})),t||this.setAllItems(this.curItems)},Tray.prototype.ensureEnoughItemsForSeeMore=function(){if(!sbCards.shouldUseHorizontalScroll()){var e=props.traySeeMoreSelector;this.traySeeMore&&this.items.length>props.minimumItemsForSeeMore?this.traySeeMore.prop("hidden",!1):this.traySeeMore&&this.items.length<props.minimumItemsForSeeMore?this.traySeeMore.prop("hidden",!0):!this.traySeeMore&&this.items.length>props.minimumItemsForSeeMore&&!Boolean(sbCards.trayMobileViewV2Possible)&&(this.traySeeMore=$("<button/>",{id:e+this.id,class:e+" sbPrimaryColor sbCta"}).append($("<span/>",{class:e+"SeeMoreText"}).text("See More")).append($("<span/>",{class:e+"SeeLessText"}).text("See Less")),this.trayNode.append(this.traySeeMore))}},Tray.prototype.getCurItems=function(){return this.curItems},Tray.prototype.setTitle=function(){var e=this.title||"Shop",t=this.allUrl.replace("view-","view/index.html"),r='<header class="sbTrayHeader isSticky"><h3 class="sbTrayTitle"><a href="'+t+'" class="sbTrayTitleLink">'+e+'</a></h3><aside class="sbTrayAside"><a href="'+t+'" class="sbTrayViewAll sbPrimaryColor">View All</a></aside></header>';""===t&&(r='<header class="sbTrayHeader isSticky"><h3 class="sbTrayTitle">'+e+"</h3></header>"),this.trayNode.prepend(r)},Tray.prototype.setTrayViewProps=function(){this.trayInnerWrapContainerSidesMargin=parseInt(this.trayInnerWrapContainer.css("marginLeft"))+parseInt(this.trayInnerWrapContainer.css("marginRight"));var e=!1,t=!0,r=0,s=this,a=this.getAllItems();this.trayItemRightMargin=0,this.trayItemLeftMargin=0,this.trayItemRightBorder=0,this.trayItemLeftBorder=0,this.setOnce("glueToMaxWidthElmWidth",this.glueToMaxWidthElm.width()),this.allWidths=[],$.each(a,(function(){$(this).removeClass("sbTrayLastItem sbTrayFirstItem");var a=$(this).outerWidth(!0);s.allWidths.push($(this).width()),a&&(e=$(this).hasClass("doubleWideCard"),s.itemWidth=e?s.itemWidth:a,r+=a,e&&!sbCards.shouldUseHorizontalScroll()&&t&&(s.trayNode.addClass("sbTrayFirstIsDoubleWide"),t=!1))}));var i=a.first(),o=a.last();s.trayItemRightMargin=parseInt(o.css("marginRight")),s.trayItemLeftMargin=parseInt(i.css("marginLeft")),s.trayItemRightBorder=parseInt(o.css("borderRightWidth")),s.trayItemLeftBorder=parseInt(i.css("borderLeftWidth")),sbCards.shouldUseHorizontalScroll()&&(this.trayInnerWrapWidth=r/this.rows),setSneakPeekNextPageCardsWidth(this)},Tray.prototype.setOnce=function(e,t){void 0===this[e]&&(this[e]=t)},Tray.prototype.getId=function(){return this.id},Tray.prototype.setDomId=function(){this.DomId||(this.DomId=props.traySelector+this.getId())},Tray.prototype.getDomId=function(){return this.DomId},Tray.prototype.setDomClass=function(){this.domClass||(this.domClass=this.classes.concat(this.defaultTrayClassesArr).join(" ")+this.rows+" "+this.theme,this.trayNode.addClass(this.getDomClass()))},Tray.prototype.getDomClass=function(){return this.domClass},Tray.prototype.setAppendToElement=function(){this.appendToElm=methods.ensureDomNode(this.appendToElm,$("."+props.defaultAppendToContClass),$("body"))},Tray.prototype.getAppendToElement=function(){return this.appendToElm},Tray.prototype.createTrayAndAppendHTML=function(){this.trayNode=$("<section/>",{id:this.getDomId()}),this.trayInnerWrap=$("<div/>",{id:props.trayInnerSelector+this.id,class:props.trayInnerSelector}),isAnswerTray(this)&&!sbCards.initialProfilerCompleted&&this.trayInnerWrap.addClass(props.answerNoInitialProfilerCaseClass),this.trayInnerWrapContainer=$("<div/>",{class:props.trayInnerContainerClass}),this.addItems(this.items,!0),this.items.length||this.remove();var e=this.trayInnerWrap;sbGlbl.isHome&&Boolean(sbHelpers.isTrayMobileViewV2Applicable())&&(this.trayInnerWrapBackground=$("<div/>",{class:props.trayInnerWrapBackgroundClass}),e=this.trayInnerWrapBackground.append(this.trayInnerWrap),isAnswerTray(this)&&!sbCards.initialProfilerCompleted&&this.setRowsCount(1)),this.trayInnerWrapContainer.append(e),this.trayNode.append(this.trayInnerWrapContainer).appendTo(this.getAppendToElement()),!sbCards.shouldUseHorizontalScroll()&&this.items.length<=props.maximumItemsForNoHorizontalScrollSingleRow&&this.trayNode.addClass("sbTraySingleRowMobileTray"),this.ensureEnoughItemsForSeeMore(),this.setDomClass(),this.setTrayViewProps()},Tray.prototype.setItemsPerPage=function(e){this.itemsPerPage=e},Tray.prototype.getItemsPerPage=function(){return this.itemsPerPage||(this.itemsPerPage=0),this.itemsPerPage},Tray.prototype.setTrayPageWidth=function(){this.pageWidth=this.setOuterTrayWidth();var e=Math.floor((this.pageWidth-this.getSneakPeekNextPageCardsWidth())/this.itemWidth);this.setItemsPerPage(e)},Tray.prototype.setOuterTrayWidth=function(){return this.isTrayMobileViewV2Applicable?this.width=this.trayNode[0].offsetWidth:(this.width=sbGlbl.midWidthPx,this.trayNode.width(this.width)),this.width},Tray.prototype.addItems=function(e,t,r){this.setCurItems(e,t),"number"==typeof r&&r>0?this.trayInnerWrap.children().eq(r-1).after(this.getCurItems()):sbHelpers.isNumeric(r)&&0===r?this.trayInnerWrap.children().eq(0).before(this.getCurItems()):this.getCurItems().appendTo(this.trayInnerWrap),t||(this.setTrayViewProps(),this.setOuterTrayWidth(),this.setTrayPageWidth())},Tray.prototype.getCardsNumber=function(){var e=$(this.trayInnerWrap).children(),t=e.filter(":visible"),r=e.filter("."+props.doubleWideCardClass);return{visible:t.length,doubleWide:r.length}},Tray.prototype.getColumnsCount=function(){return Math.ceil(this.getTrayItems()/this.getRowsCount())},Tray.prototype.getTrayWidth=function(){return this.getColumnsCount()*this.itemWidth},Tray.prototype.getTrayItems=function(){var e=this.getCardsNumber();return e.visible+e.doubleWide},Tray.prototype.handleSeeMore=function(){var e=this,t="active",r="seeMoreInTray";e.traySeeMore.hasClass(t)?(e.trayNode.removeClass(r),e.traySeeMore.removeClass(t)):(e.trayNode.addClass(r),e.traySeeMore.addClass(t))},Tray.prototype.remove=function(){this.trayNode.remove(),delete props.Trays[this.getId()]},Tray.prototype.loadCards=function(isOnGoToNext,isOnTrayReload,otherStreamID,callback,intTrayOffset,removeDuplicates){isOnGoToNext="boolean"==typeof isOnGoToNext&&isOnGoToNext,isOnTrayReload="boolean"==typeof isOnTrayReload&&isOnTrayReload;var self=this,intTrayId=self.getId(),lastPos,startIndex;if(isOnGoToNext){"number"!=typeof intTrayOffset&&(intTrayOffset=this.getTrayOffset());var delta=this.trayInnerWrapWidth-2*this.pageWidth,getMoreCards=Math.abs(intTrayOffset)+this.pageWidth>delta;if(this.loadingMoreCards||!getMoreCards||!this.allowGetMoreItems)return!1;lastPos=this.nextIndex-1,startIndex=this.nextIndex}else lastPos=0,startIndex=0;var appendToUrl="";"string"==typeof this.appendToGetCardsUrl?appendToUrl=this.appendToGetCardsUrl:"function"==typeof this.appendToGetCardsUrl&&(appendToUrl=this.appendToGetCardsUrl()),this.loadingMoreCards=!0;var locationIdParam="undefined"!=typeof streamLocationID?"&loc="+streamLocationID:"",data={h:cardHash,lastPos:lastPos,sort:this.currentSort},requestUrl="/?cmd=card-jx-more&count="+streamManualLoadLength+"&startindex="+startIndex+"&streamID="+(otherStreamID||intTrayId)+"&displayedMB="+checkDisplayedMB()+locationIdParam+appendToUrl;return $.post(requestUrl,data,(function(response){var respInfo=response;if("1"!==respInfo.charAt(0)){if("0"===respInfo.charAt(0)&&"LOGIN"==respInfo.substring(2))return noMoreCards=!0,void location.reload(!0)}else{var respObj=eval("("+respInfo.substring(2)+")"),moreCardsArry=respObj.cards;if(moreCardsArry.length){for(var i=moreCardsArry.length-1;i>=0;i--)isFailedCardType(moreCardsArry[i].cardTypeId)&&moreCardsArry.splice(i,1);if(!moreCardsArry.length)return self.allowGetMoreItems=!1,noMoreCards=!0,void self.enableNavigationRewind();self.nextIndex=respObj.nextIndex,isOnTrayReload&&(self.trayInnerWrap.empty(),self.items.splice(0,self.items.length),self.allWidths=[]);var cardsCreated=createCards(moreCardsArry,intTrayId,void 0,void 0,void 0,isOnTrayReload?respObj.streamIntro:void 0,respObj.channel,void 0,removeDuplicates,self.rows);intTrayId==FRONTEND_OFFERS&&otherStreamID==NCRAVE_TRAY&&void 0!==sbGlbl.objNCravePlacements&&void 0!==sbGlbl.objNCravePlacements.frontEndNcraveCards&&(sbGlbl.objNCravePlacements.frontEndNcraveCards=cardsCreated.clone(!0,!0)),self.addItems(cardsCreated),$.each(self.curItems,(function(){var e=$(this).data();if($.inArray(e.cardTypeId,cardsInfo.templatedVirtual)>-1){var t=cardsInfo.cardFunctions[e.cardTypeId];void 0!==t&&t(e.cardId,void 0,e)}e.customTmplFn&&"function"==typeof window[e.customTmplFn]&&window[e.customTmplFn](e)})),callNum++}else respInfo.length>2&&"1"===respInfo[2]?loadMoreCards(auto):(noMoreCards=!0,self.allowGetMoreItems=!1,self.enableNavigationRewind());self.loadingMoreCards=!1}})).done((function(){"function"==typeof callback&&callback()}))},Tray.prototype.reloadTray=function(e){this.loadCards(!1,!0,null,e,0,this.id!==FAVORITES_TRAY)},Tray.prototype.removeTrayIfEmpty=function(e,t){var r=!0,s=!1,a=$(this.getAllItems()),i=this.getItemsLen();$.each(a,(function(){var e=$(this);if(e.is(":visible")||e.hasClass(cardProps.disabledTemporarilyCardClass))return t&&e.hasClass("sbNullCard")?(i--,!0):(r=!1,!(!e.hasClass("sbStarterCard")||(s=!0,!t)))})),(!i||r&&!e||1===i&&s)&&this.remove()},Tray.prototype.onCardRemoved=function(){this.setOuterTrayWidth(),this.refresh()},Tray.prototype.onCardsAdded=function(){var e=Array.prototype.splice.call(arguments,1);this.addItems(e)},Tray.prototype.attachEvents=function(){var e=this,t=sbCards.shouldUseHorizontalScroll();this.trayNode.bind("cardRemoved",methods.bindContext(e.onCardRemoved,this)),this.trayNode.bind("cardToBeDisabled",(function(t,r){e.removeItem(r)})),this.trayNode.bind("cardDisabled",(function(){e.removeTrayIfEmpty(!1),e.decreaseRowCountIfEmptyColumn(!0)})),this.trayNode.bind("cardsAdded",methods.bindContext(e.onCardsAdded,this)),this.trayNode.bind("cardAdded",methods.bindContext(e.reloadTray,this)),t||(sbHelpers.sticky.init(void 0,e.onStickyHeaderChange),this.traySeeMore&&this.traySeeMore.bind("click",methods.bindContext(e.handleSeeMore,this))),sbPage.$window.resize(methods.bindContext(e.refresh,e))},Tray.prototype.onStickyHeaderChange=function(e){var t=e.detail.target;e.detail.stuck?t.classList.add("stuck"):t.classList.remove("stuck")},Tray.prototype.getRowsCount=function(){return this.rows},Tray.prototype.setRowsCount=function(e){Number.isInteger(e)&&(this.rows=e,this.swiper&&(this.swiper.params.grid.rows=e))},Tray.prototype.decreaseRowCountIfEmptyColumn=function(e){var t=this.getRowsCount();if(t>1){for(var r=sbCards.shouldUseHorizontalScroll();r&&(this.getItemsPerPage()>this.getColumnsCount()||this.getItemsPerPage()===this.getColumnsCount()&&this.getSneakPeekNextPageCardsWidth()+this.trayItemRightMargin>20)&&t>1||!r&&this.getItemsPerPage()>this.getColumnsCount();)t-=1,this.setRowsCount(t);var s=new RegExp("\\b"+strRowsCountClass+".*?\\b","g"),a=this.trayNode[0];a.className=a.className.replace(s,strRowsCountClass+t),sbHelpers.isBoolean(e)&&e&&this.refresh()}},Tray.prototype.initNavigation=function(){if(0!==this.getItemsLen()){var e={classNames:{card:props.cardClass,trayInner:props.trayInnerSelector},tray:this};sbHelpers.isFunction(sbPage.initializeTraySwipes)&&sbPage.initializeTraySwipes(e)}},Tray.prototype.enableNavigationRewind=function(){sbHelpers.isFunction(sbPage.manageNavigationAvailability)&&this.swiper&&sbPage.manageNavigationAvailability({swiper:this.swiper,tray:this,enableRewind:!0})},Tray.prototype.isNavigationApplicable=function(){var e=this.getId()===sbCards.objTrays.answer;return sbCards.shouldUseHorizontalScroll()&&(!e||sbCards.initialProfilerCompleted)},Tray.prototype.getSneakPeekNextPageCardsWidth=function(e){if((this.sneakPeekNextPageCardsWidth===NOT_SET_VALUE||e||sbCards.isAnswerCardV2Applicable(this.getId()))&&0!==this.getTrayItems()){if(!sbCards.shouldUseHorizontalScroll()){return 0}var t=this.isTrayMobileViewV2Applicable?this.trayNode[0].offsetWidth:sbGlbl.midWidthPx,r=this.getAllItems()[0];sbCards.isAnswerCardV2Applicable(this.getId())&&(r=r.children[0]);var s=this.itemWidth,a=r.offsetWidth;return t-s*Math.floor((t+(s-a))/s)}return this.sneakPeekNextPageCardsWidth},window.Tray=Tray,window.Trays=props.Trays}(jQuery);