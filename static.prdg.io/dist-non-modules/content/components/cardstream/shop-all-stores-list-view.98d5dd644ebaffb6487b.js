(function($){var paginationListContainer,currentPage=1,totalPages,maxPagesToShow=5,ajaxRunning=!1,$navSearchInput=$("#shopAllSearch"),$searchSuggestContainer=$("#shopAllSearchSuggestContainer"),$sbGlobalSearchSuggestList=$("#shopAllSearchSuggestWrapper"),autoSuggestTitleClassName="categoryTitle",autoSuggestSelectedClassName="selected",$sbShopSortList,$sbSortList,$categorySortBy2Link;function onDomContentLoaded(){$sbShopSortList=document.getElementById("sbShopSortList"),$sbSortList=document.getElementById("sbSortList"),$categorySortBy2Link=document.querySelectorAll(".categorySortBy2Link"),window.addEventListener("click",toggleDropdownShopSortList),$sbSortList.hidden=!0,setDropDownCurrentItem(),paginationListContainer=document.getElementById("paginationListContainer"),loadPageCards(1,30),initAutoSuggest(),$("#shopAllSearchForm").submit((function(e){e.preventDefault(),$("#sbGlobalNavSearchInputShop").val($("#shopAllSearch").val()),topbarSearch.submit()}))}function toggleDropdownShopSortList(e){var t=e.target;$sbShopSortList.classList.toggle("active");var a=$sbShopSortList.classList.contains("active");$sbSortList.hidden=t!==$sbShopSortList||!a,setDropDownCurrentItem()}function setDropDownCurrentItem(){for(var e=0,t=$categorySortBy2Link.length;e<t;e+=1)$categorySortBy2Link[e].classList.contains("selected")&&($sbShopSortList.innerHTML=$categorySortBy2Link[e].innerHTML)}function loadPageCards(pageNumber,numCardsPerPage){var cardIndex=cardsInfo.cards.length,lastCard=cardsInfo.cards[cardIndex-1],lastPosNo=lastCard?lastCard.pos:-1,data={h:cardHash,lastPos:lastPosNo,pseudoCards:createPseudoCardStr(!0),sort:cardsInfo.currentSort},appendToUrl="",locationIdParam="undefined"!=typeof streamLocationID?"&loc="+streamLocationID:"",startIndex=(pageNumber-1)*numCardsPerPage;"string"==typeof appendToGetCardsUrl?appendToUrl=appendToGetCardsUrl:"function"==typeof appendToGetCardsUrl&&(appendToUrl=appendToGetCardsUrl()),$.post("/?cmd=card-jx-more&streamID="+specificStream+"&count="+numCardsPerPage+"&startindex="+startIndex+"&displayedMB="+checkDisplayedMB()+locationIdParam+appendToUrl,data,(function(response){var respInfo=response;if("1"===respInfo.charAt(0)){var respObj=eval("("+respInfo.substring(2)+")"),moreCardsArry=respObj.cards;nextCardIndex=respObj.nextIndex;var moreCardsArrayLength=moreCardsArry.length,totalCount=respObj.totalCount,pagesLength=Math.ceil(totalCount/numCardsPerPage);return totalPages=pagesLength,pagesLength>1&&($("#sbPaginationWrapper").attr("hidden",!1),renderPaginationPanel(1)),void(moreCardsArrayLength&&(clearCardsTray(),renderPaginationPanel(pageNumber),cardsInfo.cards=moreCardsArry,getCards(0,void 0,moreCardsArrayLength),callNum++))}"0"!==respInfo.charAt(0)||"LOGIN"!=respInfo.substring(2)?$("#sbStreamLoadMoreCtaWrap").show().html("Sorry, an error occurred. Please refresh your page."):$("#sbStreamLoadMoreCtaWrap").show().html("You must be logged in to Load More Earning Opportunities. Please refresh your page.")}))}function clearCardsTray(){$("#cardDeck").empty()}function createPageBtn(e){var t=document.createElement("li"),a=document.createElement("button");a.setAttribute("data-page",e),t.appendChild(a),t.className="sbPaginationListItem",a.className="sbPaginationListItemLink",a.innerHTML=e,a.addEventListener("click",(function(){if(!a.classList.contains("active"))return currentPage=e,loadPageCards(e,30),sbPage.$content.animate({scrollTop:0},300),!1})),paginationListContainer.appendChild(t)}function toggleActivePage(){$(".sbPaginationListItemLink").removeClass("active sbBgPrimaryColor").filter("[data-page="+currentPage+"]").addClass(" active sbBgPrimaryColor")}function createArrow(e,t){var a=document.createElement("li"),s=document.createElement("button");a.appendChild(s),a.className="sbPaginationListItem "+e+" sbPaginationListItem",s.className="sbPaginationListItem "+e+"Link sbPaginationListItemLink sbPaginationNav",s.addEventListener("click",(function(){return"sbPaginationListItemNext"===e?loadPageCards(++currentPage,t):"sbPaginationListItemFirst"===e?loadPageCards(currentPage=1,t):"sbPaginationListItemLast"===e?loadPageCards(currentPage=totalPages,t):"sbPaginationListItemPrev"===e&&loadPageCards(--currentPage,t),sbPage.$content.animate({scrollTop:0},300),!1})),paginationListContainer.appendChild(a)}function updateArrowsState(){$(".sbPaginationNav").removeClass("disabled sbCta").prop("disabled",!1),currentPage===totalPages?$(".sbPaginationListItemNextLink").add(".sbPaginationListItemLastLink").addClass(" disabled sbCta").prop("disabled",!0):1===currentPage&&$(".sbPaginationListItemPrevLink").add(".sbPaginationListItemFirstLink").addClass(" disabled sbCta").prop("disabled",!0)}function renderPaginationPanel(e){var t,a,s=totalPages>maxPagesToShow;switch(e){case 1:t=e,a=e+4;break;case 2:t=e-1,a=e+3;break;case totalPages:t=e-4,a=e;break;case totalPages-1:t=e-3,a=e+1;break;default:t=e-2,a=e+2}s||(a=totalPages,t=1),clearPagination(),createArrow("sbPaginationListItemFirst",30),createArrow("sbPaginationListItemPrev",30);for(var n=t;n<=a;n++)createPageBtn(n);createArrow("sbPaginationListItemNext",30),createArrow("sbPaginationListItemLast",30),toggleActivePage(),updateArrowsState()}function clearPagination(){paginationListContainer.innerHTML=""}function initAutoSuggest(){$navSearchInput.keyup((function(e){if(27==e.keyCode)closeAutoSuggest();else if(38==e.keyCode||40==e.keyCode){var t=$sbGlobalSearchSuggestList;if(!t.children().length)return;var a=$sbGlobalSearchSuggestList.find("li."+autoSuggestSelectedClassName);if(a.length){a.removeClass(autoSuggestSelectedClassName);s=(a.is(":nth-child(2)")&&38==e.keyCode?t.find("li").not("."+autoSuggestTitleClassName).last():a.is(":last-child")&&40==e.keyCode?t.find("li").not("."+autoSuggestTitleClassName).first():38==e.keyCode?a.prevAll().not("."+autoSuggestTitleClassName).first():a.nextAll().not("."+autoSuggestTitleClassName).first()).addClass(autoSuggestSelectedClassName).find("span.suggestionName").text();$navSearchInput.val(s)}else{var s=t.find("li").not("."+autoSuggestTitleClassName).first().addClass(autoSuggestSelectedClassName).find("span.suggestionName").text();$navSearchInput.val(s)}}else if(13!=e.keyCode){var n=$navSearchInput.val().trim();n.length?getAutoSuggestResults(n):closeAutoSuggest()}}))}function closeAutoSuggest(){$searchSuggestContainer.hide(),$sbGlobalSearchSuggestList.empty()}function getAutoSuggestResults(e){!0!==ajaxRunning&&(ajaxRunning=!0,$.ajax({type:"POST",url:"/?cmd=sh-search-autocomplete",dataType:"JSON",data:{term:e},success:function(e){renderAutoSuggestResults(e)},complete:function(){ajaxRunning=!1}}))}function renderAutoSuggestResults(e){if($sbGlobalSearchSuggestList.empty(),e.data.length){$searchSuggestContainer.show();var t=0,a="";$.each(e.data,(function(s,n){if(n.name==a)return!0;if(a=n.name,++t>4)return!0;var r=4!=e.locationId?"$":"&pound;",o="";n.sbPerDollar>0?(n.upTo&&(o+="Up to "),o+=n.sbPerDollar+" SB",n.isPerDollar&&(o+=" per "+r+"1")):o+='<span class="sbNotAvailable">SB Not Available</span>',$sbGlobalSearchSuggestList.append('<li class="sbShopSearchSuggestion"><a href="'+n.url+'" class="sbShopSearchSuggestionCta"><span class="suggestionName">'+n.name+'</span><span class="suggestionSbAmount">'+o+"</span></a></li>")}))}}document.addEventListener("DOMContentLoaded",onDomContentLoaded)})(jQuery);